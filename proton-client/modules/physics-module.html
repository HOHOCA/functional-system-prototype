<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>物理模块 - MOZI 4.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #0d0d0d;
            color: #ddd;
            height: 100vh;
            overflow: hidden;
        }

        .physics-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #0d0d0d;
        }

        /* 顶部导航标签 */
        .top-nav-tabs {
            display: flex;
            background: #151515;
            border-bottom: 1px solid #2d2d2d;
            padding: 0 20px;
        }

        .top-nav-tab {
            padding: 14px 24px;
            background: transparent;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            position: relative;
        }

        .top-nav-tab.active {
            color: #3AACDE;
            border-bottom-color: #3AACDE;
        }

        .top-nav-tab:hover {
            color: #fff;
        }

        /* 主内容区域 */
        .physics-main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* 左侧导航面板 */
        .physics-left-panel {
            width: 300px;
            background: #1a1a1a;
            border-right: 1px solid #2d2d2d;
            display: flex;
            flex-direction: column;
        }

        .tree-container {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .tree-node {
            margin: 4px 0;
        }

        .tree-node-label {
            padding: 6px 8px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            color: #ccc;
            font-size: 13px;
            user-select: none;
        }

        .tree-node-label:hover {
            background: #252525;
        }

        .tree-node-label.selected {
            background: #184a73;
            color: #fff;
        }

        .tree-node-label.has-children::before {
            content: '▶';
            font-size: 10px;
            transition: transform 0.2s;
            color: #666;
        }

        .tree-node-label.expanded::before {
            transform: rotate(90deg);
        }

        .tree-children {
            margin-left: 20px;
            display: none;
        }

        .tree-node.expanded > .tree-children {
            display: block;
        }

        /* 右侧内容面板 */
        .physics-right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0d0d0d;
            overflow: hidden;
        }

        .content-tabs {
            display: flex;
            background: #151515;
            border-bottom: 1px solid #2d2d2d;
            padding: 0 20px;
        }

        .content-tab {
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            position: relative;
        }

        .content-tab.active {
            color: #3AACDE;
            border-bottom-color: #3AACDE;
        }

        .content-tab:hover {
            color: #fff;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .content-panel {
            display: none;
            max-width: 900px;
        }

        .content-panel.active {
            display: block;
        }

        .save-button {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 24px;
            background: #3AACDE;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            z-index: 100;
        }

        .save-button:hover {
            background: #3a8eef;
        }

        /* 表单样式 */
        .form-section {
            margin-bottom: 24px;
        }

        .section-label {
            display: block;
            color: #3AACDE;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #2d2d2d;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-label {
            color: #999;
            font-size: 12px;
        }

        .form-input,
        .form-select {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #ccc;
            padding: 8px 12px;
            font-size: 13px;
            height: 36px;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #3AACDE;
        }

        .form-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* 复选框和单选按钮 */
        .checkbox-group,
        .radio-group {
            margin: 12px 0;
        }

        .checkbox-item,
        .radio-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 12px;
        }

        .checkbox-item input[type="checkbox"],
        .radio-item input[type="radio"] {
            margin-top: 2px;
            cursor: pointer;
        }

        .checkbox-item label,
        .radio-item label {
            color: #ccc;
            font-size: 13px;
            cursor: pointer;
            flex: 1;
        }

        .radio-description {
            color: #666;
            font-size: 12px;
            margin-top: 4px;
            line-height: 1.5;
        }

        /* 范围输入组样式 */
        .range-input-group {
            display: flex;
            gap: 16px;
            align-items: flex-end;
        }

        .range-input-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .range-input-item .form-label {
            font-size: 11px;
            color: #999;
        }

        .range-unit {
            color: #999;
            font-size: 12px;
            padding-bottom: 8px;
            white-space: nowrap;
        }

        /* 表格样式 */
        .config-table {
            width: 100%;
            border-collapse: collapse;
            background: #1a1a1a;
            margin-top: 12px;
        }

        .config-table th,
        .config-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #2d2d2d;
            color: #ccc;
            font-size: 13px;
        }

        .config-table th {
            background: #252525;
            color: #fff;
            font-weight: 500;
        }

        .config-table tbody tr:hover {
            background: #222;
        }

        .config-table tbody tr.selected {
            background: #184a73;
        }

        .config-table input,
        .config-table select {
            width: 100%;
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
            color: #ccc;
            padding: 6px 8px;
            font-size: 13px;
            height: 32px;
            box-sizing: border-box;
        }

        .config-table input:focus,
        .config-table select:focus {
            outline: none;
            border-color: #3AACDE;
        }

        .table-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .table-action-btn {
            padding: 6px 16px;
            background: #2d2d2d;
            border: 1px solid #404040;
            color: #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }

        .table-action-btn:hover {
            background: #3a3a3a;
            color: #fff;
        }

        /* 子标签页样式 */
        .sub-tabs {
            display: flex;
            background: #151515;
            border-bottom: 1px solid #2d2d2d;
            margin-bottom: 16px;
        }

        .sub-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .sub-tab.active {
            color: #3AACDE;
            border-bottom-color: #3AACDE;
        }

        .sub-tab:hover {
            color: #fff;
        }

        .sub-tab-content {
            display: none;
        }

        .sub-tab-content.active {
            display: block;
        }


        /* 上下文菜单 */
        .context-menu {
            position: fixed;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 4px 0;
            min-width: 180px;
            z-index: 1000;
            display: none;
        }

        .context-menu-item {
            padding: 8px 16px;
            color: #ccc;
            font-size: 13px;
            cursor: pointer;
        }

        .context-menu-item:hover {
            background: #252525;
            color: #fff;
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <div class="physics-container">
        <!-- 顶部导航标签 -->
        <div class="top-nav-tabs">
            <button class="top-nav-tab active" data-tab="accelerator">粒子加速器</button>
            <button class="top-nav-tab" data-tab="ct">CT配置</button>
            <button class="top-nav-tab" data-tab="qa">QA模体</button>
        </div>

        <!-- 主内容区域 -->
        <div class="physics-main-content">
            <!-- 左侧导航面板 -->
            <div class="physics-left-panel">
                <div class="tree-container" id="treeContainer">
                    <!-- 树形结构将通过JavaScript动态生成 -->
                </div>
            </div>

            <!-- 右侧内容面板 -->
            <div class="physics-right-panel">
            <div class="content-tabs">
                <button class="content-tab active" data-tab="general">通用</button>
                <button class="content-tab" data-tab="geometric">几何</button>
                <button class="content-tab" data-tab="beamline">射束对象</button>
            </div>
            <div class="content-area">
                <!-- General 面板 -->
                <div class="content-panel active" id="generalPanel">
                    <div class="form-section">
                        <label class="section-label">通用</label>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">编号：</label>
                                <input type="text" class="form-input" value="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">机器名称：</label>
                                <input type="text" class="form-input" value="600">
                            </div>
                            <div class="form-group">
                                <label class="form-label">治疗机型号：</label>
                                <input type="text" class="form-input" value="600">
                            </div>
                            <div class="form-group">
                                <label class="form-label">治疗机发布版本：</label>
                                <input type="text" class="form-input" value="600">
                            </div>
                            <div class="form-group">
                                <label class="form-label">粒子种类：</label>
                                <input type="text" class="form-input" value="600">
                            </div>
                            <div class="form-group">
                                <label class="form-label">加速模式：</label>
                                <input type="text" class="form-input" value="600">
                            </div>
                            <div class="form-group">
                                <label class="form-label">备注：</label>
                                <input type="text" class="form-input" value="600">
                            </div>
                            <div class="form-group">
                                <label class="form-label">批准人：</label>
                                <input type="text" class="form-input" value="0.80">
                            </div>
                            <div class="form-group">
                                <label class="form-label">批准时间：</label>
                                <input type="text" class="form-input" value="0.20">
                            </div>
                            <div class="form-group">
                                <label class="form-label">拟合算法：</label>
                                <input type="text" class="form-input" value="">
                            </div>
                            <div class="form-group">
                                <label class="form-label">剂量类型：</label>
                                <select class="form-select">
                                    <option value="RBE" selected>RBE</option>
                                    <option value="PHYSICAL">PHYSICAL</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <label class="section-label">PBS</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="pbsCheckbox" checked>
                                <label for="pbsCheckbox">PBS</label>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 20px;">
                            <label class="form-label">治疗床坐标系统定义</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="couchCoord" id="couchIEC" value="IEC61217" checked>
                                    <label for="couchIEC">
                                        IEC 61217
                                        <div class="radio-description">
                                            对于HFS(头先仰卧)患者,当头部朝向机架时,治疗床角度为0度,从上方观察时,正旋转方向为逆时针。
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 20px;">
                            <label class="form-label">机架和准直器坐标系统定义：</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="gantryCoord" id="gantryIEC" value="IEC61217" checked>
                                    <label for="gantryIEC">
                                        IEC 61217
                                        <div class="radio-description">
                                            当光束在正上方照射时,机架角度为0度,面向机架时,正旋转方向为顺时针。当托盘开口面向机架时,准直器角度为180度,从源处观察,正旋转方向为逆时针。
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 20px;">
                            <label class="form-label">射束坐标系统定义：</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="beamCoord" id="beamIEC" value="IEC61217" checked>
                                    <label for="beamIEC">
                                        IEC 61217
                                        <div class="radio-description">
                                            射束坐标系符合IEC 61217。
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 16px; color: #666; font-size: 12px;">
                            所有其它坐标系统按IEC61217定义
                        </div>
                    </div>

                    <div class="form-section">
                        <label class="section-label">导出DICOM设置</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="exportDRR">
                                <label for="exportDRR">同时导出DRR</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="deleteTolerance">
                                <label for="deleteTolerance">删除容差字段</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Geometric 面板 -->
                <div class="content-panel" id="geometricPanel">
                    <!-- 机架参数 -->
                    <div class="form-section">
                        <label class="section-label">机架参数</label>
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label class="form-label">机架类型</label>
                            <input type="text" class="form-input" id="gantryType" placeholder="请输入">
                        </div>
                        <div class="form-group">
                            <label class="form-label">机架支持角度范围</label>
                            <div class="range-input-group">
                                <div class="range-input-item">
                                    <label class="form-label">起始</label>
                                    <input type="text" class="form-input" id="gantryStart" value="0.20">
                                </div>
                                <div class="range-input-item">
                                    <label class="form-label">终止</label>
                                    <input type="text" class="form-input" id="gantryEnd" value="0.20">
                                </div>
                                <div class="range-unit">deg</div>
                            </div>
                        </div>
                    </div>

                    <!-- 治疗床范围 -->
                    <div class="form-section">
                        <label class="section-label">治疗床范围</label>
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label class="form-label">旋转角度范围[deg]</label>
                            <div class="range-input-group">
                                <div class="range-input-item">
                                    <label class="form-label">起始</label>
                                    <input type="text" class="form-input" id="couchRotStart" placeholder="请输入">
                                </div>
                                <div class="range-input-item">
                                    <label class="form-label">终止</label>
                                    <input type="text" class="form-input" id="couchRotEnd" placeholder="请输入">
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label class="form-label">俯仰角度范围[deg]</label>
                            <div class="range-input-group">
                                <div class="range-input-item">
                                    <label class="form-label">起始</label>
                                    <input type="text" class="form-input" id="couchPitchStart" placeholder="请输入">
                                </div>
                                <div class="range-input-item">
                                    <label class="form-label">终止</label>
                                    <input type="text" class="form-input" id="couchPitchEnd" placeholder="请输入">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">翻转角度范围[deg]</label>
                            <div class="range-input-group">
                                <div class="range-input-item">
                                    <label class="form-label">起始</label>
                                    <input type="text" class="form-input" id="couchRollStart" placeholder="请输入">
                                </div>
                                <div class="range-input-item">
                                    <label class="form-label">终止</label>
                                    <input type="text" class="form-input" id="couchRollEnd" placeholder="请输入">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 等中心点 -->
                    <div class="form-section">
                        <label class="section-label">等中心点</label>
                        <div class="form-group">
                            <label class="form-label">等中心点最大数量</label>
                            <input type="text" class="form-input" id="maxIsocenterCount" placeholder="请输入内容">
                        </div>
                    </div>
                </div>

                <!-- Beam line objects 面板 -->
                <div class="content-panel" id="beamlinePanel">
                    <!-- Snout 部分 -->
                    <div class="form-section">
                        <label class="section-label">Snout</label>
                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>名称</th>
                                    <th>最小位置[cm]</th>
                                    <th>最大位置[cm]</th>
                                </tr>
                            </thead>
                            <tbody id="snoutTableBody">
                                <tr>
                                    <td><input type="text" value="S1"></td>
                                    <td><input type="text" value="0.00"></td>
                                    <td><input type="text" value="10.00"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Range shifter 和 Block 标签页切换 -->
                    <div class="form-section">
                        <div class="sub-tabs">
                            <button class="sub-tab active" data-subtab="rangeshifter">Range shifter</button>
                            <button class="sub-tab" data-subtab="block">Block</button>
                        </div>

                        <!-- Range shifter 内容 -->
                        <div class="sub-tab-content active" id="rangeshifterContent">
                            <table class="config-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>类型</th>
                                        <th>材料名称</th>
                                        <th>质量密度[g/cm²]</th>
                                        <th>等效水厚度[cm]</th>
                                    </tr>
                                </thead>
                                <tbody id="rangeShifterTableBody">
                                    <tr>
                                        <td><input type="text" value="RS57mm"></td>
                                        <td>
                                            <select>
                                                <option value="binary" selected>binary</option>
                                                <option value="continuous">continuous</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select>
                                                <option value="Water" selected>Water</option>
                                                <option value="PMMA">PMMA</option>
                                                <option value="Lucite">Lucite</option>
                                            </select>
                                        </td>
                                        <td><input type="text" value="1.2"></td>
                                        <td><input type="text" value="5.70"></td>
                                    </tr>
                                    <tr>
                                        <td><input type="text" value="RS34mm"></td>
                                        <td>
                                            <select>
                                                <option value="binary" selected>binary</option>
                                                <option value="continuous">continuous</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select>
                                                <option value="Water" selected>Water</option>
                                                <option value="PMMA">PMMA</option>
                                                <option value="Lucite">Lucite</option>
                                            </select>
                                        </td>
                                        <td><input type="text" value="1.2"></td>
                                        <td><input type="text" value="3.40"></td>
                                    </tr>
                                    <tr>
                                        <td><input type="text" value="RS23mm"></td>
                                        <td>
                                            <select>
                                                <option value="binary" selected>binary</option>
                                                <option value="continuous">continuous</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select>
                                                <option value="Water" selected>Water</option>
                                                <option value="PMMA">PMMA</option>
                                                <option value="Lucite">Lucite</option>
                                            </select>
                                        </td>
                                        <td><input type="text" value="1.2"></td>
                                        <td><input type="text" value="2.30"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="table-actions">
                                <button class="table-action-btn" id="copyRangeShifterBtn">复制</button>
                                <button class="table-action-btn" id="deleteRangeShifterBtn">删除</button>
                            </div>
                        </div>

                        <!-- Block 内容 -->
                        <div class="sub-tab-content" id="blockContent">
                            <table class="config-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>类型</th>
                                        <th>材料名称</th>
                                        <th>质量密度[g/cm²]</th>
                                        <th>等效水厚度[cm]</th>
                                    </tr>
                                </thead>
                                <tbody id="blockTableBody">
                                    <tr>
                                        <td><input type="text" placeholder="请输入"></td>
                                        <td>
                                            <select>
                                                <option value="binary" selected>binary</option>
                                                <option value="continuous">continuous</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select>
                                                <option value="Water" selected>Water</option>
                                                <option value="PMMA">PMMA</option>
                                                <option value="Lucite">Lucite</option>
                                            </select>
                                        </td>
                                        <td><input type="text" placeholder="请输入"></td>
                                        <td><input type="text" placeholder="请输入"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="table-actions">
                                <button class="table-action-btn" id="copyBlockBtn">复制</button>
                                <button class="table-action-btn" id="deleteBlockBtn">删除</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- 保存按钮 -->
        <button class="save-button">保存</button>

        <!-- 上下文菜单 -->
        <div class="context-menu" id="contextMenu">
            <div class="context-menu-item" data-action="newBeamQuality">新建射束质量参数</div>
            <div class="context-menu-item" data-action="commission">commission</div>
            <div class="context-menu-item" data-action="delete">删除</div>
        </div>
    </div>

    <script>
        // 树形结构数据
        const treeData = {
            accelerator: {
                Commission: {
                    'Probeam TR1': {
                        'PBS': {}
                    },
                    'IBA-Proteusone': {
                        'PBS': {}
                    }
                },
                Uncommission: {
                    'Probeam TR1': {
                        'PBS': {}
                    }
                }
            },
            ct: {},
            qa: {}
        };

        let selectedNode = null;
        let contextMenuNode = null;

        // 初始化顶部导航标签切换
        function initTopNavTabs() {
            const tabs = document.querySelectorAll('.top-nav-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const tabType = tab.dataset.tab;
                    renderTree(tabType);
                });
            });
        }

        // 初始化右侧内容标签切换
        function initContentTabs() {
            const tabs = document.querySelectorAll('.content-tab');
            const panels = document.querySelectorAll('.content-panel');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const tabId = tab.dataset.tab;
                    panels.forEach(panel => {
                        panel.classList.remove('active');
                        if (panel.id === `${tabId}Panel`) {
                            panel.classList.add('active');
                        }
                    });
                });
            });
        }

        // 渲染树形结构
        function renderTree(type = 'accelerator') {
            const container = document.getElementById('treeContainer');
            const data = treeData[type] || {};
            
            container.innerHTML = '';
            
            function createTreeNode(key, value, level = 0) {
                const node = document.createElement('div');
                node.className = 'tree-node';
                if (Object.keys(value).length > 0) {
                    node.classList.add('expanded');
                }
                
                const label = document.createElement('div');
                label.className = 'tree-node-label';
                if (Object.keys(value).length > 0) {
                    label.classList.add('has-children');
                }
                label.textContent = key;
                label.style.paddingLeft = `${level * 16 + 8}px`;
                
                label.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (Object.keys(value).length > 0) {
                        node.classList.toggle('expanded');
                        label.classList.toggle('expanded');
                    }
                    
                    // 选中节点
                    document.querySelectorAll('.tree-node-label').forEach(l => {
                        l.classList.remove('selected');
                    });
                    label.classList.add('selected');
                    selectedNode = { key, value };
                });
                
                label.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showContextMenu(e.clientX, e.clientY, key);
                    contextMenuNode = { key, value, node };
                });
                
                node.appendChild(label);
                
                if (Object.keys(value).length > 0) {
                    const children = document.createElement('div');
                    children.className = 'tree-children';
                    
                    Object.entries(value).forEach(([childKey, childValue]) => {
                        children.appendChild(createTreeNode(childKey, childValue, level + 1));
                    });
                    
                    node.appendChild(children);
                }
                
                return node;
            }
            
            Object.entries(data).forEach(([key, value]) => {
                container.appendChild(createTreeNode(key, value));
            });
        }

        // 显示上下文菜单
        function showContextMenu(x, y, nodeName) {
            const menu = document.getElementById('contextMenu');
            menu.style.display = 'block';
            menu.style.left = `${x}px`;
            menu.style.top = `${y}px`;
        }

        // 隐藏上下文菜单
        function hideContextMenu() {
            const menu = document.getElementById('contextMenu');
            menu.style.display = 'none';
        }

        // 上下文菜单操作
        function initContextMenu() {
            const menu = document.getElementById('contextMenu');
            const items = menu.querySelectorAll('.context-menu-item');
            
            items.forEach(item => {
                item.addEventListener('click', (e) => {
                    const action = item.dataset.action;
                    console.log(`执行操作: ${action}，节点: ${contextMenuNode?.key}`);
                    
                    // 这里可以添加具体的操作逻辑
                    if (action === 'delete' && contextMenuNode) {
                        if (confirm(`确定要删除 "${contextMenuNode.key}" 吗？`)) {
                            // 删除节点的逻辑
                            console.log('删除节点:', contextMenuNode.key);
                        }
                    }
                    
                    hideContextMenu();
                });
            });
            
            // 点击其他地方隐藏菜单
            document.addEventListener('click', (e) => {
                if (!menu.contains(e.target)) {
                    hideContextMenu();
                }
            });
        }

        // 保存按钮
        function initSaveButton() {
            const saveBtn = document.querySelector('.save-button');
            saveBtn.addEventListener('click', () => {
                console.log('保存配置...');
                alert('配置已保存');
            });
        }

        // 初始化Range shifter表格操作
        function initRangeShifterActions() {
            const copyBtn = document.getElementById('copyRangeShifterBtn');
            const deleteBtn = document.getElementById('deleteRangeShifterBtn');
            const tableBody = document.getElementById('rangeShifterTableBody');

            // 复制功能
            if (copyBtn) {
                copyBtn.addEventListener('click', () => {
                    const selectedRows = tableBody.querySelectorAll('tr.selected');
                    if (selectedRows.length === 0) {
                        alert('请先选择要复制的行');
                        return;
                    }
                    
                    selectedRows.forEach(row => {
                        const newRow = row.cloneNode(true);
                        // 清除选中状态
                        newRow.classList.remove('selected');
                        // 更新ID（添加副本标识）
                        const idInput = newRow.querySelector('td:first-child input');
                        if (idInput) {
                            idInput.value = idInput.value + '_copy';
                        }
                        tableBody.appendChild(newRow);
                    });
                });
            }

            // 删除功能
            if (deleteBtn) {
                deleteBtn.addEventListener('click', () => {
                    const selectedRows = tableBody.querySelectorAll('tr.selected');
                    if (selectedRows.length === 0) {
                        alert('请先选择要删除的行');
                        return;
                    }
                    
                    if (confirm(`确定要删除选中的 ${selectedRows.length} 行吗？`)) {
                        selectedRows.forEach(row => row.remove());
                    }
                });
            }

            // 行选择功能
            if (tableBody) {
                tableBody.addEventListener('click', (e) => {
                    const row = e.target.closest('tr');
                    if (!row) return;
                    
                    if (e.ctrlKey || e.metaKey) {
                        // Ctrl/Cmd 点击：多选
                        row.classList.toggle('selected');
                    } else {
                        // 普通点击：单选
                        tableBody.querySelectorAll('tr').forEach(r => r.classList.remove('selected'));
                        row.classList.add('selected');
                    }
                });
            }
        }

        // 初始化Block表格操作
        function initBlockActions() {
            const copyBtn = document.getElementById('copyBlockBtn');
            const deleteBtn = document.getElementById('deleteBlockBtn');
            const tableBody = document.getElementById('blockTableBody');

            // 复制功能
            if (copyBtn) {
                copyBtn.addEventListener('click', () => {
                    const selectedRows = tableBody.querySelectorAll('tr.selected');
                    if (selectedRows.length === 0) {
                        alert('请先选择要复制的行');
                        return;
                    }
                    
                    selectedRows.forEach(row => {
                        const newRow = row.cloneNode(true);
                        // 清除选中状态
                        newRow.classList.remove('selected');
                        // 更新ID（添加副本标识）
                        const idInput = newRow.querySelector('td:first-child input');
                        if (idInput) {
                            idInput.value = idInput.value + '_copy';
                        }
                        tableBody.appendChild(newRow);
                    });
                });
            }

            // 删除功能
            if (deleteBtn) {
                deleteBtn.addEventListener('click', () => {
                    const selectedRows = tableBody.querySelectorAll('tr.selected');
                    if (selectedRows.length === 0) {
                        alert('请先选择要删除的行');
                        return;
                    }
                    
                    if (confirm(`确定要删除选中的 ${selectedRows.length} 行吗？`)) {
                        selectedRows.forEach(row => row.remove());
                    }
                });
            }

            // 行选择功能
            if (tableBody) {
                tableBody.addEventListener('click', (e) => {
                    const row = e.target.closest('tr');
                    if (!row) return;
                    
                    if (e.ctrlKey || e.metaKey) {
                        // Ctrl/Cmd 点击：多选
                        row.classList.toggle('selected');
                    } else {
                        // 普通点击：单选
                        tableBody.querySelectorAll('tr').forEach(r => r.classList.remove('selected'));
                        row.classList.add('selected');
                    }
                });
            }
        }

        // 初始化子标签页切换
        function initSubTabs() {
            const subTabs = document.querySelectorAll('.sub-tab');
            const subTabContents = document.querySelectorAll('.sub-tab-content');
            
            subTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetId = tab.dataset.subtab;
                    
                    // 切换标签状态
                    subTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // 切换内容显示
                    subTabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${targetId}Content`) {
                            content.classList.add('active');
                        }
                    });
                });
            });
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            initTopNavTabs();
            initContentTabs();
            renderTree('accelerator');
            initContextMenu();
            initSaveButton();
            initRangeShifterActions();
            initBlockActions();
            initSubTabs();
        });
    </script>
</body>
</html>

